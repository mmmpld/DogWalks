function initMarker(e,a,n){if(isDefined(e))for(var o=e.length,r=null,i=0;o>i;i++){r=e[i];var t=r.Lat,s=r.Lng,l=r.Name,g=r.URL,m=r.centerOn;l="undefined"!=typeof l?l:"Walk Location",m="undefined"!=typeof m?m:!1,placeMarker(t,s,l,g,m,a,n)}}function isDefined(e){return"undefined"!=typeof e?!0:!1}function placeMarker(e,a,n,o,r,i,t){var s=new google.maps.LatLng(e,a);i.map=map,i.position=s,i.title=n,i.url=o;var l=new google.maps.Marker(i);if(o)google.maps.event.addListener(l,"click",function(){window.location.href=this.url});else if(r){var g='<h5 class="mapInfoHeader">'+n+"</h5>";l.infowindow=new google.maps.InfoWindow({content:g}),google.maps.event.addListener(l,"click",function(){l.infowindow.open(map,l)}),setTimeout(function(){l.infowindow.open(map,l)},1200)}return r&&setTimeout(function(){map.panTo(s)},300),(i.draggable=!0)&&google.maps.event.addListener(l,"dragend",function(){var e=l.getPosition(),a={Lat:e.lat(),Lng:e.lng()};"undefined"!=typeof markerDoneDrag&&markerDoneDrag(a)}),t?t(l):!0}function calcRoute(){var e=document.getElementById("DirectionsAddress").value,a=new google.maps.LatLng(DirectionsLat,DirectionsLng),n={origin:e,destination:a,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(n,function(e,a){a==google.maps.DirectionsStatus.OK?directionsDisplay.setDirections(e):$("#DirectionsErrors").html("<div>Could not locate address, please be more specific</div>")})}var map,walkMarker,userMarker,localMarker,directionsDisplay,directionsService;jQuery(document).ready(function(){function e(){var e=new google.maps.LatLng(userPos.Lat?userPos.Lat:-46.651,userPos.Lng?userPos.Lng:168.409),r={center:e,zoom:11,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),r),directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0,map:map,panel:document.getElementById("DirectionsPanel")}),google.maps.event.addListenerOnce(map,"idle",function(){function e(){walkMarker?(initMarker(walkMarker,n),clearInterval(t)):i>20?clearInterval(t):++i}function r(){userMarker?(initMarker(userMarker,a),clearInterval(l)):s>20?clearInterval(l):++s}"undefined"!=typeof mapReady&&mapReady();var i=0,t=setInterval(e,100),s=0,l=setInterval(r,100);setTimeout(function(){function e(){localMarker?(initMarker(localMarker,o),clearInterval(n)):a>20?clearInterval(n):++a}var a=0,n=setInterval(e,100)},1e3)})}google.maps.visualRefresh=!0;var a={draggable:!1,icon:new google.maps.MarkerImage("themes/dogwalks/images/map/marker_user.png"),zIndex:800},n={draggable:!1,animation:google.maps.Animation.DROP,icon:new google.maps.MarkerImage("themes/dogwalks/images/map/marker.png"),zIndex:900},o={draggable:!1,animation:google.maps.Animation.DROP,icon:new google.maps.MarkerImage("themes/dogwalks/images/map/marker_local.png")};google.maps.event.addDomListener(window,"load",e)});