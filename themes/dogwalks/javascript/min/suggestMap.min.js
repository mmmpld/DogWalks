function mapReady(){$("#map-canvas a").each(function(){this.tabIndex=-1}),0!=$lat.val()&&0!=$lng.val()&&(Lat=$lat.val(),Lng=$lng.val(),setTimeout(function(){updateOrCreateMarker()},1e3)),$('<button class="icon" id="AddressSearch" title="Mark on map">?</button>').appendTo("#Address .middleColumn"),$("#AddressSearch").click(function(e){e.preventDefault(),$addressSelector.val()&&(requestGeocodeUpdate($addressSelector.val(),updateFormGeocode),$locationPrefilled.text("(set from address)"))})}function updateOrCreateMarker(){if(newWalkMarker){var e=new google.maps.LatLng(Lat,Lng);newWalkMarkerRef.setPosition(e),setTimeout(function(){map.panTo(e)},300)}else newWalkMarker?console.log("failed to create or update new walk marker"):(revealMap(),newWalkMarker=[{Lat:Lat,Lng:Lng,Name:Name,centerOn:!0}],initMarker(newWalkMarker,markerOptionsNewWalk,newWalkMarkerSetRef))}function revealMap(){$("#Address").addClass("mapShowing"),$("#Map").animate({height:"400px"},400)}function newWalkMarkerSetRef(e){newWalkMarkerRef=e,setTimeout(function(){newWalkMarkerRef.infowindow.close()},4e3)}function markerDoneDrag(e){addressFromGeocode(e.Lat,e.Lng,updateFormAddress),Lat=e.Lat,Lng=e.Lng,$lat.val(Math.round(1e7*Lat)/1e7),$lng.val(Math.round(1e7*Lng)/1e7),$locationPrefilled.text("(set from marker position)")}function requestGeocodeUpdate(e,a){0==requestGeocodeUpdateTimer&&(geocodeFromAddress(e,a),requestGeocodeUpdateTimer=200,setTimeout(function(){requestGeocodeUpdateTimer=0},requestGeocodeUpdateTimer))}function updateFormGeocode(e){Lat=e.Lat,Lng=e.Lng,$lat.val(Lat),$lng.val(Lng),updateOrCreateMarker()}function updateFormAddress(e){Address=e[0].formatted_address,$addressSelector.val(Address)}var $addressSelector,$locationPrefilled,$lat,$lng;jQuery(document).ready(function(e){$addressSelector=e("#WalkSuggestForm_suggested_Address"),$locationPrefilled=e("#LocationPrefilled"),$lat=e("#WalkSuggestForm_suggested_Lat"),$lng=e("#WalkSuggestForm_suggested_Lng"),e("#WalkSuggestForm_suggested_Walk-Name").change(function(){Name=e(this).val()}),$addressSelector.change(function(){requestGeocodeUpdate(e(this).val(),updateFormGeocode),$locationPrefilled.text("(set from address)")}),e("#map-canvas").height("400px")});var updateLatLngFromExif=function(e){e.GPSLatitude&&e.GPSLongitude&&e.GPSLatitudeRef&&e.GPSLongitudeRef&&(Lat=exifGPSToDecimal(e.GPSLatitude[0],e.GPSLatitude[1],e.GPSLatitude[2],e.GPSLatitudeRef),Lng=exifGPSToDecimal(e.GPSLongitude[0],e.GPSLongitude[1],e.GPSLongitude[2],e.GPSLongitudeRef),$lat.val(Math.round(1e7*Lat)/1e7),$lng.val(Math.round(1e7*Lng)/1e7),updateOrCreateMarker(),addressFromGeocode(Lat,Lng,updateFormAddress),$locationPrefilled.text("(set from image location data)"))},requestGeocodeUpdateTimer=0;