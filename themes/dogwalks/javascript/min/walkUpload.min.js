function checkAdvancedUploadRequirements(){void 0!==window.FormData&&Modernizr.canvas&&Modernizr.draganddrop&&window.File&&window.FileReader&&window.FileList&&window.Blob&&(replaceDefaultUpload(),listenDragDrop())}function replaceDefaultUpload(){var e=$.parseJSON(previouslyUploadedImages),a="";if(e)for(var o in e)a+='<li><input type="text" name="UploadedFiles[]" value="'+e[o]+'" class="text completed" readonly><div id="progress'+UploadCount+'"></div></li>',UploadCount++;var n='<label class="left" for="WalkSuggestForm_suggested_Walk-Image">Walk Image</label><span>Drag images to the box or select an image (max 10)</span><ol id="UploadedFiles">'+a+"</ol>"+'<ul id="UploadedErrors"></ul>'+'<div class="middleColumn ">'+'  <div id="ImageDrop"></div><button id="UploadButton">Select Image</button>'+'<input type="file" name="" class="file" id="UploadHidden" style="display:none;" multiple >'+"</div>";$("#Walk-Image").html(n).addClass("js"),$("#UploadButton").click(function(e){e.preventDefault(),$("#UploadHidden").click()}),$("#UploadHidden").change(function(){addImageUploads(this.files)})}function listenDragDrop(){function e(e){e.stopPropagation(),e.preventDefault(),$(this).addClass("drop")}function a(e){e.stopPropagation(),e.preventDefault(),$(this).removeClass("drop")}function o(e){e.stopPropagation(),e.preventDefault()}function n(e){e.stopPropagation(),e.preventDefault();var a=e.dataTransfer,o=a.files;t(o),$(this).removeClass("drop")}function t(e){addImageUploads(e)}var l=document.getElementById("ImageDrop");l.addEventListener("dragenter",e,!1),l.addEventListener("dragleave",a,!1),l.addEventListener("dragover",o,!1),l.addEventListener("drop",n,!1)}function uploadError(e,a){var o='<a class="uploadErrorDismiss" title="dismiss error"><span>dismiss error</span></a><li class="uploadError '+a+'">'+e+"</li>",n=$(o).appendTo("#UploadedErrors");"warning"==a&&setTimeout(function(){n.removeClass("warning")},2e3),$(".uploadErrorDismiss").click(function(e){e.preventDefault(),$(this).next().slideUp(),$(this).remove()})}function addImageUploads(e){function a(){if(e[o]){if(!(UploadMax>UploadCount))return uploadError("Max uploads of "+UploadMax+" reached","warning"),void 0;processImage(e[o])}else console.log("Something went wrong");setTimeout(function(){o++,n>o&&a()},2e3)}var o=0,n=e.length;a()}function processImage(e){var a=["image/jpeg","image/gif","image/png"];if(UploadMax>UploadCount)if(a.indexOf(e.type)>-1)if(e.size<=MaxUploadBytes){UploadCount++;var o='<li><input type="text" name="UploadedFiles[]" value="'+e.name+'" class="text" readonly><div id="progress'+UploadCount+'"></div></li>';$("#UploadedFiles").append(o),prepThumb(e),Lat||Lng||$.fileExif(e,updateLatLngFromExif),UploadFile(e,UploadCount)}else uploadError(e.name+" is too big to upload. Please resize and try again","warning");else uploadError(e.name+" cannot be uploaded. Only .jpg .gif .png are accepted","warning");else uploadError("Max uploads of "+UploadMax+" reached","warning")}function prepThumb(e){document.getElementById("ImageThumb");var a=document.createElement("img"),o=new FileReader;o.onload=function(e){a.src=e.target.result,setTimeout(function(){},100)},o.readAsDataURL(e)}function drawThumb(e,a){var o=a.getContext("2d"),n=100,t=100,l=e.width,r=e.height;l>r?l>n&&(r*=n/l,l=n):r>t&&(l*=t/r,r=t),a.width=l,a.height=r;try{o.drawImage(e,0,0,l,r)}catch(d){console.log(d),console.trace()}}function UploadFile(e,a){var o=new XMLHttpRequest;if(o.upload){var n=document.getElementById("progress"+UploadCount),t=n.appendChild(document.createElement("p"));t.appendChild(document.createTextNode("upload "+e.name)),o.upload.addEventListener("progress",function(e){var a=parseInt(100-100*(e.loaded/e.total));t.style.backgroundPosition=a+"% 0"},!1),o.onreadystatechange=function(){if(4==o.readyState){var e=a-1,n=$("#UploadedFiles li:eq("+e+") input");200==o.status?(t.className="success",n.addClass("success"),setTimeout(function(){n.addClass("completed"),n.removeClass("success")},1e3)):(t.className="failure",n.addClass("failure didnotcomplete"))}};var l=document.getElementById("WalkSuggestForm_suggested");document.getElementById("WalkSuggestForm_suggested_SecurityID"),o.open("POST",l.action,!0),o.setRequestHeader("X_FILENAME",e.name),o.send(e)}else o.upload?console.log("image upload failed"):console.log("xhr upload not available")}function dataURItoBlob(e){for(var a=atob(e.split(",")[1]),o=[],n=0;n<a.length;n++)o.push(a.charCodeAt(n));return new Blob([new Uint8Array(o)],{type:"image/jpeg"})}var UploadCount=0,UploadMax=10;jQuery(document).ready(function(){checkAdvancedUploadRequirements()});